{#
    Cart page template.
    - Displays all items in the user's cart with quantity controls, item removal, and cost calculation.
    - Shows order summary, shipping, and total cost.
    - Integrates with cart.js for dynamic updates and cart.css for styling.
    - "Proceed to Secure Checkout" button posts to the checkout route.
    - Stripe image and note indicate secure payment.
    - Ensure all referenced IDs/classes match those in cart.js and cart.css.
#}
{% extends 'user_Base.html' %}
{% block title %}Your Cart{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/cart.css') }}">
<div class="cart-container">
    <h2>Your Cart</h2>

    <div class="cart-main">
        <div class="cart-items">
            {# Loop through cart items and render each with controls #}
            {% for item in cart_items %}
            <div class="cart-item" id="cart-item-{{ item.product.id }}">
                <!-- Product image logic unchanged -->
                <div class="cart-item-info">
                    <div class="cart-item-title">{{ item.product.name }}</div>
                    <div class="cart-item-price">${{ "%.2f"|format(item.product.price) }}</div>
                </div>
                <div class="cart-item-qty">
                    <button type="button" class="qty-btn" data-product-id="{{ item.product.id }}" data-delta="-1">-</button>
                    <span id="quantity-{{ item.product.id }}">{{ item.quantity }}</span>
                    <button type="button" class="qty-btn" data-product-id="{{ item.product.id }}" data-delta="1">+</button>
                </div>
                <div class="cart-item-cost">
                    $<span id="cost-{{ item.product.id }}">{{ "%.2f"|format(item.product.price * item.quantity) }}</span>
                </div>
                <button type="button" class="cart-item-remove" data-product-id="{{ item.product.id }}">&#128465;</button>
            </div>
            {% endfor %}
            <a href="{{ url_for('products.show_products') }}" class="btn btn-secondary mt-3">← Continue Shopping</a>
        </div>
        <div class="cart-summary">
            <div class="cart-delivery">
                <h5>Delivery Options</h5>
                <div>
                    <span class="float-end text-danger" id="shipping-cost">$5.00</span>
                    <div class="text-muted small">Delivery to your campus address.</div>
                </div>
            </div>
            <div class="cart-order-summary">
                <h5>Order Summary</h5>
                <div class="d-flex justify-content-between">
                    <span>Subtotal</span>
                    <span id="subtotal-cost">${{ "%.2f"|format(subtotal) }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Shipping</span>
                    <span id="shipping-summary">$5.00</span>
                </div>
                <div class="d-flex justify-content-between fw-bold">
                    <span>Total</span>
                    <span id="total-cost">${{ "%.2f"|format(total) }}</span>
                </div>
            </div>
            <form action="{{ url_for('cart.checkout') }}" method="post">
                <button type="submit" class="btn btn-primary w-100 mt-3">Proceed to Secure Checkout</button>
            </form>
            <img src="{{ url_for('static', filename='images/stripe.png') }}" alt="Stripe">
            <div class="small text-muted">Secure payments powered by Stripe</div>
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/cart.js') }}"></script>
{% endblock %}